{% extends 'base.html' %}

{% block content %}
{% include 'navbar.html' %}

<div class="overflow-x-hidden min-h-screen flex flex-col" style="background: linear-gradient(to bottom, white, #87CEEB); padding-top: 88px;">
    <div class="flex justify-start items-center mb-4 mx-auto">
        {% if bookmarks %}
        <ul class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
            {% for product in bookmarks %}
            <li class="bg-white shadow-md rounded-lg p-4 border border-gray-300 flex flex-col" style="width: 250px;">
                <img src="{{ product.picture_link }}" alt="{{ product.item }}" class="h-32 w-full object-cover rounded-md mb-4">
                <h3 class="font-bold text-lg mb-1">{{ product.item }}</h3>
                <p class="text-gray-700 mb-1">{{ product.kategori }}</p>
                
                <div class="flex justify-center mt-2">
                    <a href="{% url 'bookmark:remove_bookmark' product.id %}" class="text-white font-semibold bg-red-500 border-2 border-red-500 rounded-lg px-10 py-1 hover:bg-red-700 hover:text-white transition duration-300">Remove Product</a>
                </div>
                
                <div class="flex flex-col items-center mt-2" id="note-{{ product.id }}" style="text-align: center;">
                    <div id="note-container-{{ product.id }}">
                        {% if product.note %}
                        <button class="text-blue-600 font-semibold border-2 border-blue-600 rounded-lg px-14 py-1 mt-2 hover:bg-blue-600 hover:text-white transition duration-300" onclick="editNote('{{ product.id }}')">Edit Note</button>
                        <p class="text-gray-700 mt-2 truncate overflow-hidden" id="note-content-{{ product.id }}" style="max-height: 80px; overflow-y: auto; word-wrap: break-word; white-space: pre-wrap;">{{ product.note }}</p>
                        {% else %}
                        <button class="text-blue-600 font-semibold border-2 border-blue-600 rounded-lg px-14 py-1 mt-2 hover:bg-blue-600 hover:text-white transition duration-300" onclick="addNote('{{ product.id }}')">+ Add Note</button>
                        {% endif %}
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="text-center font-semibold text-black mt-4">Bookmark anda masih kosong</p>
        {% endif %}
    </div>
</div>

<!-- Popup note -->
<div class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 hidden" id="popup-note">
    <div class="bg-white rounded-lg p-4 w-1/2 mx-auto mt-20">
        <h3 class="font-bold text-lg mb-4 text-center">Add Note</h3>
        <form onsubmit="return false;">
            <textarea class="w-full p-2 h-40 border-2 border-blue-600 outline-none focus:border-black" id="note-input"></textarea>
            <div class="flex justify-end mt-4">
                <button class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded" onclick="cancelNote()">Cancel</button>
                <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2" onclick="saveNote()">Save</button>
            </div>
        </form>
    </div>
</div>

<script>
let currentProductId = null;

function addNote(productId) {
    currentProductId = productId;
    document.getElementById('popup-note').classList.remove('hidden');
    document.getElementById('note-input').value = ''; 
}

function editNote(productId) {
    currentProductId = productId;
    const currentNote = document.getElementById(`note-content-${productId}`);
    document.getElementById('note-input').value = currentNote ? currentNote.textContent : ''; 
    document.getElementById('popup-note').classList.remove('hidden');
}

function saveNote() {
    const noteInput = document.getElementById('note-input');
    const note = noteInput.value;
    document.getElementById('popup-note').classList.add('hidden');
    const noteContainer = document.getElementById(`note-container-${currentProductId}`);
    noteContainer.innerHTML = '';

    if (note.trim() !== '') {
        const editButton = document.createElement('button');
        editButton.className = 'text-blue-600 font-semibold border-2 border-blue-600 rounded-lg px-14 py-1 mt-2 hover:bg-blue-600 hover:text-white transition duration-300';
        editButton.textContent = 'Edit Note';
        editButton.onclick = function() { editNote(currentProductId); };
        noteContainer.appendChild(editButton);

        const noteElement = document.createElement('p');
        noteElement.className = 'text-gray-700 mt-2 truncate overflow-hidden';
        noteElement.style.maxHeight = '80px';
        noteElement.style.overflowY = 'auto';
        noteElement.style.wordWrap = 'break-word';
        noteElement.style.whiteSpace = 'pre-wrap';
        noteElement.textContent = note;
        noteElement.id = `note-content-${currentProductId}`;
        noteContainer.appendChild(noteElement);
    } else {
        const addButton = document.createElement('button');
        addButton.className = 'text-blue-600 font-semibold border-2 border-blue-600 rounded-lg px-14 py-1 mt-2 hover:bg-blue-600 hover:text-white transition duration-300';
        addButton.textContent = '+ Add Note';
        addButton.onclick = function() { addNote(currentProductId); };
        noteContainer.appendChild(addButton);
    }
}

function cancelNote() {
    document.getElementById('popup-note').classList.add('hidden');
}
</script>

{% endblock content %}